"use strict";angular.module("app-base",["ngSanitize","ngAnimate"]).run(["$rootScope","$http","$httpParamSerializerJQLike",function(e,t,n){e.pageTitle="滕运锋 | Yakima Teng",e.friends=[{url:"http://www.kun.la/",name:"马力"},{url:"http://www.tipskill.com/",name:"TipSkill药学博客"},{url:"http://www.ruanyifeng.com/blog/",name:"阮一峰"},{url:"http://www.orzzone.com/wp-admin",name:"管理"}],e.menus=[{menu:"Pharmaceuticals",title:"药学资讯",tip:"侧重点为药品注册相关的文章，多数来自互联网",href:"/blog/#/categories/pharmaceutical-information/1",fontAwesomeIconClass:"fa-line-chart"},{menu:"Html",title:"HTML",tip:"All are about html",href:"/blog/#/categories/html/1",fontAwesomeIconClass:"fa-html5"},{menu:"CSS",title:"CSS",tip:"Bootstrap, WechatUI, CSS2&3 and more",href:"/blog/#/categories/css/1",fontAwesomeIconClass:"fa-css3"},{menu:"JavaScript",title:"JavaScript",tip:"AngularJS, VueJS, jQuery and more",href:"/blog/#/categories/javascript/1",fontAwesomeIconClass:"fa-line-chart"},{menu:"About",title:"关于",tip:"关于博主和这个站点的一些介绍",href:"/blog/#/pages/about",fontAwesomeIconClass:"fa-gitlab"}],e.judgeBrowser=function(e){var t=e.toLowerCase(),n="";return/firefox/.test(t)&&!/seamonkey/.test(t)?(n=t.match(/firefox\/([0-9\.]+)/)[1].split(".")[0],"Firefox@"+n):t.indexOf("edge")>-1?(n=t.match(/edge\/([0-9\.]+)/)[1].split(".")[0],"Edge@"+n):t.indexOf("opera")>-1?(n=t.match(/opera\/([0-9\.]+)/)[1].split(".")[0],"Opera@"+n):t.indexOf("opr")>-1?(n=t.match(/opr\/([0-9\.]+)/)[1].split(".")[0],"Opera@"+n):t.indexOf("seamonkey")>-1?(n=t.match(/seamonkey\/([0-9\.]+)/),"Seamonkey@"+n):t.indexOf("chromium")>-1?(n=t.match(/chromium\/([0-9\.]+)/)[1].split(".")[0],"Chromium@"+n):t.indexOf("chrome")>-1&&!/chromium|edge/.test(t)?(n=t.match(/chrome\/([0-9\.]+)/)[1].split(".")[0],"chrome@"+n):t.indexOf("safari")>-1&&!/(chrome|chromium|edge)/.test(t)?(n=t.match(/safari\/([0-9\.])+/)[1].split(".")[0],"Safari@"+n):/window.*trident.*rv:11\.0/.test(t)?(n=t.match(/rv:([0-9\.]+)/)[1].split(".")[0],"Internet Explorer@"+n):/; msie/.test(t)?(n=t.match(/msie\s([0-9\.]+)/)[1].split(".")[0],"Internet Explorer@"+n):"神奇浏览器"},e.formatDate=function(e){if(e=new Date(e),isNaN(e.valueOf()))return"Amazing Date";var t=e.getFullYear(),n=e.getMonth()<9?"0"+(e.getMonth()+1):""+(e.getMonth()+1),s=e.getDate()<10?"0"+e.getDate():""+e.getDate(),o=e.getHours()<10?"0"+e.getHours():""+e.getHours(),r=e.getMinutes()<10?"0"+e.getMinutes():""+e.getMinutes();return[t,n,s].join("-")+" "+o+":"+r}}]).service("Api",["$rootScope","$http","$httpParamSerializerJQLike",function(e,t,n){var s=this,o=window.location.href.indexOf("localhost")===-1?location.protocol+"//yakima.duapp.com":"";s.get=function(e,n){var s=t({method:"GET",url:o+e,params:n||{},timeout:3e4});return s},s.post=function(e,n){var s=t({method:"POST",url:o+e,data:n||{},timeout:3e4});return s},s.highlightCode=function(){setTimeout(function(){$("pre code").each(function(e,t){hljs.highlightBlock(t),$(this).hasClass("xml")&&$(this).text($(this).html())})},0)},s.insertTagP=function(e){return/(<\/a>)|(<\/p>)|(<\/ul>)|(<\/div>)|(<\/dl>)|(<\/article>)|(<\/header>)|(<\/footer>)|(<\/pre>)/.test(e)?(e=e.replace(/<p>\s*?<\/p>/g,""),e=e.replace(/<\/p>\s+?<p>/g,"</p><p>")):(e="<p>"+e.replace(/\B(\n|\r|(\r\n)|(\u0085)|(\u2028)|(\u2029))+\B/g,"</p><p>")+"</p>",e=e.replace(/(<p>)\1/g,"$1"),e=e.replace(/<p>\s*?<\/p>/g,""),e=e.replace(/<\/p>\s+?<p>/g,"</p><p>"),e=e.replace(/<p>(<h[1-6]>)/g,"$1"),e=e.replace(/(<\/h[1-6]>)<\/p>/g,"$1")),e}}]).filter("hasParentComment",[function(){return function(e,t){return e.filter(function(e,n,s){return e.comment_parent===t})}}]).directive("activeLink",["$location",function(e){var t=function(t,n){t.$watch(function(){return e.path()},function(e){var t=n.attr("href");e.replace(/[0-9]*$/g,"")===t.replace(/^\/blog\/#/g,"").replace(/[0-9]*$/g,"")?(n.addClass("active"),n.find("span.selected").length<1&&n.append('<span class="selected"></span>')):(n.removeClass("active"),n.find("span.selected").remove())})};return{restrict:"A",link:t}}]).directive("appFooter",[function(){return{restrict:"E",replace:!0,templateUrl:"tpls/footer.html",scope:!1}}]).directive("appSidebar",[function(){return{restrict:"E",replace:!0,templateUrl:"tpls/sidebar.html",scope:!1}}]).directive("appHeader",[function(){return{restrict:"E",replace:!0,templateUrl:"tpls/header.html",scope:!1}}]),angular.module("templates",[]).run(["$templateCache",function(e){e.put("tpls/archive.html",'<section class="app-archives">\r\n    <div class="header">Title</div>\r\n    <ul>\r\n        <li ng-repeat="item in allPosts"><a ng-href="/blog/#/posts/{{item.ID}}">{{item.post_title}}</a></li>\r\n    </ul>\r\n</section>'),e.put("tpls/categories.html",'<ul class="categories">\r\n    <li ng-repeat="x in categories" class="category">\r\n        <a ng-href="/blog/#/categories/{{x.slug}}">\r\n            <header><i class="fa fa-3x" ng-class="categoriesLogos[x.slug]"></i></header>\r\n            <article>\r\n                {{x.name}}\r\n            </article>\r\n            <aside ng-show="!x.posts.length" class="dotting"></aside>\r\n            <aside ng-show="x.posts.length">{{x.posts.length}}</aside>\r\n        </a>\r\n    </li>\r\n</ul>'),e.put("tpls/category.html",'<article>\r\n    <ul class="category_posts">\r\n        <li ng-repeat="item in posts">\r\n            <a ng-href="/blog/#/posts/{{item.ID}}">\r\n                <span>{{item.post_title}}</span>\r\n                <span>{{item.post_date}}</span>\r\n            </a>\r\n        </li>\r\n    </ul>\r\n</article>'),e.put("tpls/footer.html",'<footer class="app-footer">\r\n  <div class="app-footer-widgets">\r\n    <section class="app-footer-widget" ng-if="recentComments.length">\r\n      <h4>Comments</h4>\r\n      <ul class="comments">\r\n        <li ng-repeat="item in recentComments"><a ng-href="/blog/#/posts/{{item.comment_post_ID}}">{{item.comment_excerpt}}</a></li>\r\n      </ul>\r\n    </section>\r\n    <section class="app-footer-widget" ng-if="pages.length">\r\n      <h4>Pages</h4>\r\n      <ul class="pages">\r\n        <li ng-repeat="item in pages"><a ng-href="/blog/#/pages/{{item.post_name}}">{{item.post_title}}</a></li>\r\n      </ul>\r\n    </section>\r\n    <section class="app-footer-widget" ng-if="randomPosts.length">\r\n      <h4>Articles</h4>\r\n      <ul class="posts">\r\n        <li ng-repeat="item in randomPosts"><a ng-href="/blog/#/posts/{{item.ID}}">{{item.post_title}}</a> <span>{{formatDate(item.post_date)}}</span></li>\r\n      </ul>\r\n    </section>\r\n  </div>\r\n  <small class="app-footer-copyright">\r\n    <span class="item">Copyright &copy; 2009-{{currentYear}} Yakima Teng.</span>\r\n    <span class="item">Powered by Node.js &amp; WordPress &amp; MySql.</span>\r\n  </small>\r\n</footer>'),e.put("tpls/header.html",'<nav class="app-nav" id="app-nav">\r\n  <a active-link href="/blog/#/1" class="item item-logo" data-title="首页" data-tooltip="进入首页">\r\n    <img class="img" src="./img/yakima_bright.jpg" alt="Yakima Teng">\r\n    <span class="line">Yakima Teng</span>\r\n  </a>\r\n  <a ng-repeat="item in menus" active-link class="item item-normal" ng-href="{{item.href}}" data-title="{{item.title}}" data-tooltip="{{item.tip}}">\r\n    <i ng-class="item.fontAwesomeIconClass" class="fa"></i>\r\n    <span class="line">{{item.menu}}</span>\r\n  </a>\r\n  <form class="item-form" ng-submit="search($event)">\r\n    <input ng-model="keyword" type="text" class="field" placeholder="Search..." autocomplete="on" />\r\n    <button class="btn" type="submit">^_^</button>\r\n  </form>\r\n</nav>'),e.put("tpls/login.html",'<!--<div id="output"></div>-->\r\n<div class="login">\r\n    <section class="form-item">\r\n        <aside class="left">\r\n            <label for="login-name">用户名</label>\r\n        </aside>\r\n        <article>\r\n            <input type="text" id="login-name" placeholder="your user name">\r\n        </article>\r\n    </section>\r\n    <section class="form-item">\r\n        <aside>\r\n            <label for="login-password">密&nbsp;码</label>\r\n        </aside>\r\n        <article>\r\n            <input type="text" id="login-password" placeholder="your password">\r\n        </article>\r\n    </section>\r\n    <section class="form-item">\r\n        <article>\r\n            <button>登陆</button>\r\n        </article>\r\n    </section>\r\n</div>'),e.put("tpls/page.html",'<section class="app-post">\r\n  <header class="app-post-header">\r\n    <h1 class="title">{{post.post_title}}</h1>\r\n  </header>\r\n  <aside class="app-post-byline">\r\n    <span class="date">{{formatDate(post.post_date)}}</span>\r\n  </aside>\r\n  <article class="app-post-content" ng-bind-html="post.post_content"></article>\r\n</section>\r\n'),e.put("tpls/post.html",'<article class="app-post">\r\n  <header class="app-post-header">\r\n    <h1 class="title">{{post.post_title}}</h1>\r\n  </header>\r\n  <aside class="app-post-byline">\r\n    <span class="category"><a ng-href="{{\'/blog/#/categories/\' + post.slug + \'/1\'}}">{{post.name}}</a></span>\r\n    <span class="date">{{formatDate(post[\'post_date\'])}}</span>\r\n  </aside>\r\n  <article class="app-post-content" ng-bind-html="post.post_content"></article>\r\n  <footer class="app-post-footer">\r\n    <span class="title">相关文章</span>\r\n    <span class="item" ng-repeat="item in relatedPosts">\r\n      <a ng-href="/blog/#/posts/{{item[\'ID\']}}">{{item.post_title}}</a>\r\n    </span>\r\n  </footer>\r\n  <section class="app-post-nav">\r\n    <a ng-href="{{nextPostId === \'\' ? \'\' : \'/blog/#/posts/\' + nextPostId + fromValueString}}" class="next">{{nextPostStatus}}</a>\r\n    <a ng-href="{{prePostId === \'\' ? \'\' : \'/blog/#/posts/\' + prePostId + fromValueString}}" class="pre">{{prePostStatus}}</a>\r\n  </section>\r\n  <section class="app-post-comments">\r\n    <section ng-repeat="commentOne in relatedComments | filter:getFirstLevelComments" class="post_comment">\r\n      <header class="header">\r\n        <a ng-href="{{commentOne.comment_author_url}}" class="post_comment_author">{{commentOne.comment_author}}</a>\r\n        <span class="item">{{formatDate(commentOne.comment_date)}}</span>\r\n        <span class="item">{{judgeBrowser(commentOne.comment_agent)}}</span>\r\n        <span ng-click="reply(commentOne)" class="item outstanding">回复</span>\r\n      </header>\r\n      <article class="post_comment_content">{{commentOne.comment_content}}</article>\r\n      <section ng-repeat="commentTwo in relatedComments | hasParentComment:commentOne.comment_ID" class="post_comment inner-comment">\r\n        <header class="header">\r\n          <a ng-href="{{commentTwo.comment_author_url}}" class="post_comment_author">{{commentTwo.comment_author}}</a>\r\n          <span class="item">{{formatDate(commentTwo.comment_date)}}</span>\r\n          <span class="item">{{judgeBrowser(commentTwo.comment_agent)}}</span>\r\n          <span ng-click="reply(commentTwo)" class="item outstanding">回复</span>\r\n        </header>\r\n        <article class="post_comment_content">{{commentTwo.comment_content}}</article>\r\n        <section ng-repeat="commentThree in relatedComments | hasParentComment:commentTwo.comment_ID" class="post_comment inner-comment">\r\n          <header class="header">\r\n            <a ng-href="{{commentThree.comment_author_url}}" class="post_comment_author">{{commentThree.comment_author}}</a>\r\n            <span class="item">{{formatDate(commentThree.comment_date)}}</span>\r\n            <span class="item">{{judgeBrowser(commentThree.comment_agent)}}</span>\r\n            <span ng-click="reply(commentThree)" class="item outstanding">回复</span>\r\n          </header>\r\n          <article class="post_comment_content">{{commentThree.comment_content}}</article>\r\n          <section ng-repeat="commentFour in relatedComments | hasParentComment:commentThree.comment_ID" class="post_comment inner-comment">\r\n            <header class="header">\r\n              <a ng-href="{{commentFour.comment_author_url}}" class="post_comment_author">{{commentFour.comment_author}}</a>\r\n              <span class="item">{{formatDate(commentFour.comment_date)}}</span>\r\n              <span class="item">{{judgeBrowser(commentFour.comment_agent)}}</span>\r\n              <span ng-click="reply(commentFour)" class="item outstanding">回复</span>\r\n            </header>\r\n            <article class="post_comment_content">{{commentFour.comment_content}}</article>\r\n            <section ng-repeat="commentFive in relatedComments | hasParentComment:commentFour.comment_ID" class="post_comment inner-comment">\r\n              <header class="header">\r\n                <a ng-href="{{commentFive.comment_author_url}}" class="post_comment_author">{{commentFive.comment_author}}</a>\r\n                <span class="item">{{formatDate(commentFive.comment_date)}}</span>\r\n                <span class="item">{{judgeBrowser(commentFive.comment_agent)}}</span>\r\n                <!-- <span ng-click="reply(commentFive)" class="item outstanding">回复</span> -->\r\n              </header>\r\n              <article class="post_comment_content">{{commentFive.comment_content}}</article>\r\n            </section>\r\n          </section>\r\n        </section>\r\n      </section>\r\n    </section>\r\n  </section>\r\n  <section class="app-post-comment-submit">\r\n    <div class="fields">\r\n      <div class="item">\r\n        <label for="commentAuthor" class="label">Name</label>\r\n        <input ng-model="comment.author" id="commentAuthor" type="text" class="field" placeholder="Your name">\r\n      </div>\r\n      <div class="item">\r\n        <label for="commentEmail" class="label">Email</label>\r\n        <input ng-model="comment.email" id="commentEmail" type="text" class="field" placeholder="Your email">\r\n      </div>\r\n      <div class="item">\r\n        <label for="commentUrl" class="label">Blog Url</label>\r\n        <input ng-model="comment.url" id="commentUrl" type="text" class="field" placeholder="your blog url">\r\n      </div>\r\n    </div>\r\n    <div class="content">\r\n      <div ng-class="{\'show\': comment.tip !== \'\'}" class="detail-mask">\r\n        <div class="tip">\r\n          <div class="text">{{comment.tip}}</div>\r\n          <div class="timing">（弹框将于{{comment.timing}}秒后关闭）</div>\r\n        </div>\r\n      </div>\r\n      <textarea ng-model="comment.message" class="detail" id="commentMessage" placeholder="为防止垃圾评论，要求评论内容需以英文开头，以中文结尾，比如：Hello,你真棒"></textarea>\r\n      <button ng-click="submitComment()" class="submit">发表评论</button>\r\n    </div>\r\n  </section>\r\n</article>'),e.put("tpls/posts.html",'<article class="app-posts">\r\n    <div>\r\n        <article class="app-excerpt" ng-show="!isWaiting && recentPosts.length" ng-repeat="item in recentPosts">\r\n            <header class="app-excerpt-header">\r\n                <a ng-href="{{\'/blog/#/posts/\' + item[\'ID\'] + \'?from=\' + (from || \'posts\') + \'&value=\' + (value || \'\')}}">{{item[\'post_title\']}}</a>\r\n            </header>\r\n            <aside class="app-excerpt-byline">\r\n                <span class="category"><a ng-href="{{\'/blog/#/categories/\' + item.slug + \'/1\'}}">{{item.name}}</a></span>\r\n                <span class="date">{{formatDate(item[\'post_date\'])}}</span>\r\n            </aside>\r\n            <article class="app-excerpt-content" ng-bind-html="item[\'post_excerpt\'].html"></article>\r\n            <footer ng-show="item.comment_count === 0" class="app-excerpt-footer">\r\n                <span class="title">暂无评论</span>\r\n            </footer>\r\n            <footer ng-show="item.comment_count !== 0" class="app-excerpt-footer">\r\n                <span class="title">最新评论</span>\r\n                <span class="item"><a ng-href="{{\'/blog/#/posts/\' + item[\'ID\'] + \'?from=\' + (from || \'posts\') + \'&value=\' + (value || \'\')}}">{{item.recent_comment_content}}</a></span>\r\n            </footer>\r\n        </article>\r\n        <article ng-show="!isWaiting && !recentPosts.length">\r\n            (⊙o⊙)哦，没有文章了\r\n        </article>\r\n        <!-- <article ng-show="isWaiting" class="waiting">\r\n            <i class="fa fa-cog fa-spin fa-3x fa-fw margin-bottom"></i>\r\n            加载中\r\n        </article> -->\r\n    </div>\r\n</article>\r\n<section class="app-page-nav" ng-if="recentPosts.length">\r\n    <a ng-if="currentPostsPageId > 1" ng-href="{{baseLink + (currentPostsPageId - 1)}}" class="first"></a>\r\n    <a ng-if="currentPostsPageId > 5 && recentPosts.length == 10" ng-repeat="i in [-5,-4,-3,-2,-1,0,1,2,3,4]" ng-class="{true: \'active\'}[i == 0]" ng-href="{{baseLink + (currentPostsPageId + i)}}">{{currentPostsPageId + i}}</a>\r\n    <a ng-if="currentPostsPageId > 5 && recentPosts.length < 10" ng-repeat="i in [-5,-4,-3,-2,-1,0]" ng-class="{true: \'active\'}[i == 0]" ng-href="{{baseLink + (currentPostsPageId + i)}}">{{currentPostsPageId + i}}</a>\r\n    <a ng-if="currentPostsPageId <= 5 && recentPosts.length == 10" ng-repeat="i in [1,2,3,4,5,6,7,8,9,10]" ng-class="{\'active\': i == currentPostsPageId}" ng-href="{{baseLink + i}}">{{i}}</a>\r\n    <a ng-if="currentPostsPageId <= 5 && recentPosts.length < 10 && i <= currentPostsPageId" ng-repeat="i in [1,2,3,4,5,6,7,8,9,10]" ng-class="{\'active\': i == currentPostsPageId}" ng-href="{{baseLink + i}}">{{i}}</a>\r\n    <a ng-if="recentPosts.length == 10" ng-href="{{baseLink + (currentPostsPageId + 1)}}" class="last"></a>\r\n</section>'),e.put("tpls/sidebar.html",'<aside class="app-sidebar">\r\n  <section class="widget-text">\r\n    <img class="top" src="./img/34.jpg" alt="">\r\n    <img class="photo" src="./img/suolong.jpg" alt="">\r\n    <article class="content">\r\n      目前在魔都。13年毕业于北药，在浙江top10的一家上市药企做过2年的国际药品注册。15年末正式加入智商暴躁的前端程序员大军。\r\n      <br><a href="/blog/#/pages/about">更多内容请点击此处</a>\r\n      <audio loop controls oncanplay="document.getElementById(\'audio\').volume = 0.3" id="audio" class="audio">\r\n        <source src="http://yakima.duapp.com/uploads/xiaoyaotan.mp3" type="audio/mpeg" />\r\n        Your browser does not support the audio element.\r\n      </audio>\r\n    </article>\r\n    <footer class="social">\r\n      <span class="qq"></span>\r\n      <span class="wechat"></span>\r\n      <span class="email"></span>\r\n    </footer>\r\n  </section>\r\n  <section class="widget-normal" ng-if="categories.length">\r\n    <h4 class="widget-title"><span>分类目录</span></h4>\r\n    <ul class="categories">\r\n      <li ng-repeat="item in categories" class="list"><a ng-href="/blog/#/categories/{{item.slug}}/1">{{item.name}}</a></li>\r\n    </ul>\r\n  </section>\r\n  <section class="widget-normal" ng-if="archives.length">\r\n    <h4 class="widget-title"><span>文章归档</span></h4>\r\n    <ul class="archives">\r\n      <li ng-repeat="item in archives" class="list"><a ng-href="/blog/#/archives/{{item.year + \'-\' + item.month}}/1">{{item.year}}年{{item.month}}月</a></li>\r\n    </ul>\r\n  </section>\r\n  <section class="widget-normal" ng-if="friends.length">\r\n    <h4 class="widget-title"><span>一些链接</span></h4>\r\n    <ul class="links">\r\n      <li ng-repeat="item in friends" class="list"><a ng-href="{{item.url}}">{{item.name}}</a></li>\r\n    </ul>\r\n  </section>\r\n</aside>')}]);var archive={url:"/archives/:year-:month/:id",templateUrl:"tpls/posts.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){t.from="archives",t.value=n.year+"-"+n.month,t.baseLink="/blog/#/archives/"+n.year+"-"+n.month+"/",t.currentPostsPageId=parseInt(n.id),e.isWaiting=!0,s.get("/blog/v1/archives",{offset:10*(parseInt(n.id)-1),limit:"10",year:parseInt(n.year),month:parseInt(n.month)}).success(function(e){t.recentPosts=e.responseBody}).finally(function(){return e.isWaiting=!1})}]},categories={url:"/categories",templateUrl:"tpls/categories.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){t.categoriesLogos={"qq-diary":"fa-qq","qq-copy":"fa-folder-o",diary:"fa-user",authoring:"fa-edit",else:"fa-terminal","office-software":"fa-file-word-o","article-by-others":"fa-chrome",usp:"fa-rocket",english:"fa-beer","pharmaceutical-information":"fa-newspaper-o","regulatory-affairs":"fa-registered","pharmaceutical-knowledge":"fa-university","reading-book":"fa-book"},e.isWaiting=!0;for(var o=function(t,n){s.get("/blog/v1/posts",{sortby:"ID",order:"rand",cat:e.categories[t].slug}).success(function(n){e.categories[t].posts=n.responseBody}).finally(function(){return e.isWaiting=!1})},r=0,a=e.categories.length;r<a;r++)o(r,a)}]},category={url:"/categories/:slug/:id",templateUrl:"tpls/posts.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){t.baseLink="/blog/#/categories/"+n.slug+"/",t.currentPostsPageId=parseInt(n.id),e.isWaiting=!0,t.from="categories",t.value=n.slug,s.get("/blog/v1/excerpts",{sortby:"ID",order:"desc",cat:n.slug.toLowerCase(),offset:10*(parseInt(n.id)-1),limit:"10"}).success(function(e){t.recentPosts=e.responseBody}).finally(function(){return e.isWaiting=!1})}]},login={url:"/login",templateUrl:"tpls/login.html",controller:["$rootScope","$scope",function(e,t){}]},page={url:"/pages/:name",templateUrl:"tpls/page.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){e.isWaiting=!0,s.get("/blog/v1/pages/"+n.name).success(function(e){return t.post=e.responseBody}).finally(function(){return e.isWaiting=!1})}]},post={url:"/posts/:id?from&value",templateUrl:"tpls/post.html",controller:["$rootScope","$scope","$stateParams","$timeout","$interval","$sce","Api",function(e,t,n,s,o,r,a){t.postId=n.id,t.prePostId="",t.prePostStatus="正在查询上一篇文章信息",t.nextPostId="",t.nextPostStatus="正在查询下一篇文章信息",t.fromValueString="?from="+(n.from||"posts")+"&value="+(n.value||""),a.get("/blog/v1/post-siblings",{id:n.id,from:n.from||"posts",value:n.value||""}).success(function(e){""===e.responseBody.pre.postId?(t.prePostId="",t.prePostStatus="没有更早的文章了"):(t.prePostId=e.responseBody.pre.postId,t.prePostStatus=e.responseBody.pre.postTitle),""===e.responseBody.next.postId?(t.nextPostId="",t.nextPostStatus="没有更新的文章了"):(t.nextPostId=e.responseBody.next.postId,t.nextPostStatus=e.responseBody.next.postTitle)}).error(function(){t.prePostId="",t.prePostStatus="获取上一篇文章信息失败",t.nextPostId="",t.nextPostStatus="获取下一篇文章信息失败"}),t.comment={parent:"",author:"",email:"",url:"",message:"",tip:"",timing:5,flag:!0,replyHint:""},e.isWaiting=!0,a.get("/blog/v1/posts/"+t.postId).success(function(e){t.post=e.responseBody,t.post.post_content=r.trustAsHtml(a.insertTagP(t.post.post_content)),a.highlightCode()}).finally(function(){return e.isWaiting=!1}),t.getRelatedPost=function(){return a.get("/blog/v1/related-posts",{id:t.postId,limit:1}).success(function(e){return t.relatedPosts=e.responseBody})},t.getComments=function(){return a.get("/blog/v1/comments",{postId:t.postId,limit:20}).success(function(e){return t.relatedComments=e.responseBody})},t.countingDown=function(e,n){t.comment.timing=e,s(function(){t.comment.tip="",n&&n()},1e3*e);var r=o(function(){t.comment.timing--,t.comment.timing<1&&(o.cancel(r),t.comment.timing=e)},1e3)},t.validateComment=function(){return t.comment.author?t.comment.email?t.comment.url?!!t.comment.message||(t.comment.tip="请输入评论内容",$("#commentMessage").trigger("focus"),t.countingDown(6),!1):(t.comment.tip="请输入博客地址",$("#commentUrl").trigger("focus"),t.countingDown(6),!1):(t.comment.tip="请输入邮箱",$("#commentEmail").trigger("focus"),t.countingDown(6),!1):(t.comment.tip="请输入姓名",$("#commentAuthor").trigger("focus"),t.countingDown(6),!1)},t.reply=function(e){var n=e;t.comment.parent=n.comment_ID,t.comment.replyHint="to [["+n.comment_author+"]]: ",t.comment.message=t.comment.replyHint,$("#commentMessage").trigger("focus")},t.submitComment=function(){t.comment.flag!==!1&&t.validateComment()!==!1&&(t.comment.flag=!1,""!==t.comment.replyHint&&t.comment.message.indexOf(t.comment.replyHint)!==-1||(t.comment.parent="0",t.comment.replyHint=""),a.post("/blog/v1/submit-comment",{postId:t.postId,parent:t.comment.parent,author:t.comment.author,email:t.comment.email,url:t.comment.url,message:t.comment.message}).success(function(e){var n=e.responseBody;return n.success===!1?(t.comment.tip=n.msg,void t.countingDown(6,function(){t.comment.flag=!0})):(t.comment.tip=n.msg,t.countingDown(6,function(){t.comment.flag=!0}),void t.getComments())}).error(function(){t.comment.tip="提交评论失败，可能是网络问题",t.countingDown(6,function(){t.comment.flag=!0})}))},t.getFirstLevelComments=function(e){return 0===e.comment_parent},t.getRelatedPost(),t.getComments()}]},posts={url:"/:id",templateUrl:"tpls/posts.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){t.baseLink="/blog/#/",t.currentPostsPageId=parseInt(n.id),t.from="posts",t.value="",e.isWaiting=!0,s.get("/blog/v1/excerpts",{sortby:"ID",order:"desc",offset:10*(parseInt(n.id)-1),limit:"10"}).success(function(e){t.recentPosts=e.responseBody}).finally(function(){return e.isWaiting=!1})}]},randomPost={url:"/posts/random",templateUrl:"tpls/post.html",controller:["$rootScope","$scope","$injector","Api",function(e,t,n,s){e.isWaiting=!0,n.get("$templateCache").removeAll(),s.get("/blog/v1/posts",{sortby:"ID",order:"rand",offset:0,limit:"1"}).success(function(n){t.post=n.responseBody[0],s.get("/blog/v1/related-posts",{id:t.post.ID,limit:20}).success(function(e){return t.relatedPosts=e.responseBody}).finally(function(){return e.isWaiting=!1}),s.get("/blog/v1/comments",{postId:t.post.ID,limit:20}).success(function(e){return t.relatedComments=e.responseBody})})}]},searchResult={url:"/search?:keyword&:pagenumber",templateUrl:"tpls/posts.html",controller:["$rootScope","$scope","$stateParams","Api",function(e,t,n,s){var o=n.keyword;t.from="search",t.value=o,t.baseLink="/blog/#/search?keyword="+o+"&pagenumber=",t.currentPostsPageId=parseInt(n.pagenumber),e.isWaiting=!0,s.get("/blog/v1/search",{keyword:o,sortby:"post_date",order:"desc",offset:10*(t.currentPostsPageId-1),limit:"10"}).success(function(e){t.recentPosts=e.responseBody}).finally(function(){return e.isWaiting=!1})}]};angular.module("app",["app-base","ui.router","templates"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/1"),e.state("所有目录",categories).state("指定目录",category).state("随机文章",randomPost).state("具体文章",post).state("具体页面",page).state("指定月份",archive).state("登陆管理",login).state("搜索结果",searchResult).state("文章列表",posts)}]).run(["$rootScope","$state","$timeout","Api",function(e,t,n,s){function o(){var t=Object.keys(r),s=!0,o=!1,a=void 0;try{for(var i,c=t[Symbol.iterator]();!(s=(i=c.next()).done);s=!0){var l=i.value;if(l===!1)return}}catch(e){o=!0,a=e}finally{try{!s&&c.return&&c.return()}finally{if(o)throw a}}n(function(){e.isLoading=!1},300)}window.app=e,e.keyword="";var r={categories:!1,randomPosts:!1,pages:!1,archives:!1,recentComments:!1};e.isLoading=!0,e.isWaiting=!1,s.get("/blog/v1/categories").success(function(t){return e.categories=t.responseBody}).error(function(){}).finally(function(){r.categories=!0,o()}),s.get("/blog/v1/posts",{sortby:"ID",order:"rand",limit:"10"}).success(function(t){return e.randomPosts=t.responseBody}).finally(function(){r.randomPosts=!0,o()}),s.get("/blog/v1/pages").success(function(t){return e.pages=t.responseBody}).finally(function(){r.pages=!0,o()}),s.get("/blog/v1/archive-data").success(function(t){return e.archives=t.responseBody}).finally(function(){r.archives=!0,o()}),s.get("/blog/v1/comments",{order:"desc",offset:"0",limit:"10"}).success(function(t){return e.recentComments=t.responseBody}).finally(function(){r.recentComments=!0,o()}),e.search=function(t){t.preventDefault(),window.location.href="/blog/#/search?keyword="+e.keyword+"&pagenumber=1"},e.currentYear=(new Date).getFullYear(),window.onload=window.onhashchange=function(){$("html, body").animate({scrollTop:0},"slow"),enableTooltips("app-nav")}}]);